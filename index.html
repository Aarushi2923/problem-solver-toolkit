<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Problem-Solver's Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937, #111827);
            background-attachment: fixed;
        }
        .container {
            max-width: 900px;
        }
        .scrollable-content {
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        /* Custom scrollbar styles */
        .scrollable-content::-webkit-scrollbar {
            width: 8px;
        }
        .scrollable-content::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }
        .scrollable-content::-webkit-scrollbar-thumb {
            background: #6366f1;
            border-radius: 10px;
        }
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container bg-white bg-opacity-95 rounded-xl shadow-2xl p-8 space-y-8 w-full backdrop-blur-sm">
        <div class="text-center">
            <h1 class="text-4xl font-extrabold text-gray-800 flex items-center justify-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-600" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <span>The Problem-Solver's Toolkit</span>
            </h1>
            <p class="mt-2 text-gray-600">Simulate a consulting engagement. Input a business problem below to receive a structured analysis and solution.</p>
        </div>

        <!-- Input Section -->
        <div class="space-y-4">
            <label for="problem-input" class="block text-gray-700 font-semibold">Describe the business problem:</label>
            <textarea id="problem-input" rows="4" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 transition duration-300 bg-gray-50 placeholder-gray-400" placeholder="e.g., 'How can a small coffee shop increase its evening sales?'"></textarea>
            <button id="generate-btn" class="w-full bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                Generate Solution
            </button>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex flex-col items-center justify-center my-8 text-gray-600">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-t-4 border-gray-400 border-t-indigo-600 mb-4"></div>
            <p>Analyzing problem and generating a solution...</p>
        </div>

        <!-- Output Section -->
        <div id="solution-output" class="hidden">
            <div class="bg-gray-50 bg-opacity-70 border border-gray-200 rounded-lg p-8 space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Your Structured Solution:</h2>
                <div id="response-content" class="text-gray-700 scrollable-content leading-relaxed space-y-4"></div>
                <div id="citations" class="mt-6 text-xs text-gray-500 border-t pt-4"></div>
            </div>
        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const problemInput = document.getElementById('problem-input');
        const loadingIndicator = document.getElementById('loading-indicator');
        const solutionOutput = document.getElementById('solution-output');
        const responseContent = document.getElementById('response-content');
        const citationsDiv = document.getElementById('citations');

        generateBtn.addEventListener('click', generateSolution);

        async function generateSolution() {
            const userQuery = problemInput.value.trim();
            if (userQuery === '') {
                displayMessage('Please enter a business problem to analyze.', 'error');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            solutionOutput.classList.add('hidden');
            generateBtn.disabled = true;
            responseContent.innerHTML = '';
            citationsDiv.innerHTML = '';
            
            const apiKey = "AIzaSyB32Z05baer-b9iPE_6zNOOSuPxhOAN_kQ";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            if (apiKey === "") {
                loadingIndicator.classList.add('hidden');
                displayMessage("Error: Please provide a valid API key in the code to run this application.", 'error');
                generateBtn.disabled = false;
                return;
            }

            const systemPrompt = `You are a world-class strategic consultant. Your task is to provide a structured, data-driven analysis and a set of actionable recommendations for a given business problem. 
            
            Format your response in Markdown, using clear headings, bullet points, and bold text. The structure should be:

            1.  **Executive Summary:** A concise, single-paragraph overview of the problem and your core recommendation.
            2.  **Problem Statement:** Rephrase the user's problem in a clear, concise way.
            3.  **Key Challenges & Opportunities:** Identify the main factors at play. Use bullet points.
            4.  **Proposed Solution:** Detail a step-by-step, actionable plan. Use numbered lists.
            5.  **Metrics for Success:** Suggest specific, measurable metrics to track progress.
            6.  **Potential Risks:** Identify possible roadblocks and mitigation strategies.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let response;
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            } catch (error) {
                loadingIndicator.classList.add('hidden');
                displayMessage('Failed to fetch a solution. Please try again later.', 'error');
                console.error('Fetch error:', error);
                generateBtn.disabled = false;
                return;
            }

            try {
                const result = await response.json();
                const candidate = result?.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    responseContent.innerHTML = renderMarkdown(text);
                    solutionOutput.classList.remove('hidden');

                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    if (sources.length > 0) {
                        citationsDiv.innerHTML = '<p class="font-bold mt-4">Sources:</p>';
                        sources.forEach((source, index) => {
                            const link = document.createElement('a');
                            link.href = source.uri;
                            link.textContent = `${index + 1}. ${source.title}`;
                            link.target = '_blank';
                            link.classList.add('block', 'underline', 'text-indigo-600', 'hover:text-indigo-800');
                            citationsDiv.appendChild(link);
                        });
                    }
                } else {
                    displayMessage('No solution found. The model may be unable to process this request.', 'error');
                }
            } catch (error) {
                displayMessage('Error parsing the solution. Please try again.', 'error');
                console.error('JSON parsing error:', error);
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        function renderMarkdown(markdown) {
            let html = markdown
                .replace(/^### (.*$)/gim, '<h3 class="text-xl font-bold mt-4">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-6">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mt-8">$1</h1>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/^- (.*$)/gim, '<li>$1</li>');
            
            html = html.replace(/\n/g, '<br>');
            return html;
        }

        function displayMessage(message, type) {
            const existingMessage = document.querySelector('.message-box');
            if (existingMessage) existingMessage.remove();

            const messageBox = document.createElement('div');
            messageBox.className = `message-box p-4 rounded-md text-sm text-center shadow-lg transition-all duration-300 ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            messageBox.textContent = message;
            
            document.body.appendChild(messageBox);

            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => messageBox.remove(), 300);
            }, 5000);
        }
    </script>
</body>
</html>
